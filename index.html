<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Phone-first + safe areas -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Diecast Society LB</title>

  <style>
      :root{
 --bg:#181818;      /* main background */
--panel:#1f1f1f;   /* cards / panels */
--panel2:#242424;  /* secondary panels */

      --text:#f6f6f6;
      --muted:#bdbdbd;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.18);

      --accent:#d4a017;   /* mustard */
--accent2:#f2c94c;  /* soft yellow */


      --shadow:0 16px 44px rgba(0,0,0,.55);
      --shadow2:0 24px 70px rgba(0,0,0,.65);

      --radius:18px;
      --radius2:22px;
      --max:1200px;
    }

    *{ box-sizing:border-box; }
    html{ -webkit-text-size-adjust:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 480px at 50% -10%, rgba(242,201,76,.22), transparent 60%),
radial-gradient(700px 420px at 90% 20%, rgba(212,160,23,.18), transparent 65%),

        linear-gradient(180deg, #1f1f1f, #242424 20%, #202020);


      overflow-x:hidden;
      -webkit-overflow-scrolling: touch;
      touch-action: manipulation;
    }
    a{ color:inherit; text-decoration:none; }
    img{ max-width:100%; display:block; }

    .safe{
      padding-left: max(14px, env(safe-area-inset-left));
      padding-right: max(14px, env(safe-area-inset-right));
    }

    /* ========= TOP BAR (PHONE FRIENDLY) ========= */
    .topbar{
      position: sticky;
      top:0;
      z-index: 60;
      padding: 10px 0;
      background: linear-gradient(180deg, rgba(7,7,7,.92), rgba(7,7,7,.70), rgba(7,7,7,0));
      backdrop-filter: blur(10px);
    }
    .topbar-inner{
      max-width: var(--max);
      margin: 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .brand-mini{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .brand-dot{
      width:34px; height:34px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,122,24,.45), transparent 55%),
        linear-gradient(180deg, rgba(255,59,10,.18), rgba(15,15,15,.95));
      box-shadow: 0 14px 36px rgba(0,0,0,.55);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
      overflow:hidden;
    }
    .brand-dot::after{
      content:"";
      width:18px; height:18px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius:6px;
      opacity:.85;
      filter: blur(.2px);
    }
    .brand-mini .name{
      font-weight:1000;
      letter-spacing:.6px;
      text-transform:uppercase;
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 48vw;
    }
    .brand-mini .sub{
      font-size:11px;
      color: rgba(255,255,255,.65);
      font-weight:800;
      letter-spacing:.25px;
    }

    .cart-pill{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,59,10,.18), rgba(15,15,15,.88));
      box-shadow: 0 14px 40px rgba(0,0,0,.6);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      flex: 0 0 auto;
    }
    .cart-icon{
      width:18px; height:18px; display:inline-block;
      background: radial-gradient(circle at 30% 30%, var(--accent2), var(--accent));
      -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2Zm10 0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2ZM7.16 14h9.87c.75 0 1.41-.41 1.75-1.03l3.24-5.88A1 1 0 0 0 21.15 6H6.21L5.27 4H2v2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 8 19h12v-2H8l1.16-2Z"/></svg>') center / contain no-repeat;
              mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2Zm10 0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2ZM7.16 14h9.87c.75 0 1.41-.41 1.75-1.03l3.24-5.88A1 1 0 0 0 21.15 6H6.21L5.27 4H2v2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 8 19h12v-2H8l1.16-2Z"/></svg>') center / contain no-repeat;
    }
    .cart-pill .label{
      font-weight:1000;
      letter-spacing:.5px;
      text-transform:uppercase;
      font-size:12px;
    }
    .badge{
      min-width:22px;
      height:22px;
      padding:0 7px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      font-weight:1000;
      background: linear-gradient(180deg, var(--accent2), var(--accent));
      color:#0b0b0b;
    }

    /* ========= HERO (more compact on phone) ========= */
    .hero{
      position:relative;
      padding: 10px 0 18px;
    }
    .wrap{ max-width:var(--max); margin:0 auto; }

    .hero-card{
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,.10);
      background:
       radial-gradient(800px 240px at 50% 0%, rgba(242,201,76,.20), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(10,10,10,.92));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .hero-inner{
      padding: 16px 14px 14px;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:10px;
    }
    .logo{
      width:min(260px, 76vw);
      filter: drop-shadow(0 18px 26px rgba(0,0,0,.70));
    }
    .title{
      margin:6px 0 0;
      font-size: clamp(22px, 5.4vw, 38px);
      font-weight: 1000;
      letter-spacing: 1.1px;
      text-transform: uppercase;
      line-height:1.05;
    }
    .tagline{
      margin:0;
      color: rgba(255,255,255,.68);
      font-weight: 800;
      letter-spacing:.35px;
      font-size: 13px;
    }
    .cta-row{
      display:flex;
      gap:10px;
      width:100%;
      margin-top: 6px;
    }
    .btn{
      flex:1;
      border:0;
      cursor:pointer;
      padding:12px 12px;
      border-radius:999px;
      font-weight:1000;
      letter-spacing:.6px;
      text-transform:uppercase;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-primary{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color:#0b0b0b;
      box-shadow: 0 18px 40px rgba(255,59,10,.20);
    }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
    }

    /* ========= SECTION ========= */
    .section{ padding: 14px 0 90px; }
    .section-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .section-header h2{
      margin:0;
      font-size:14px;
      letter-spacing:.8px;
      text-transform:uppercase;
      color:rgba(255,255,255,.92);
      font-weight:1000;
    }

    /* âœ… FILTERS: ALWAYS 3 PER ROW (phone included) */
    .filters{
      width: min(520px, 100%);
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:10px;
    }
    .chip{
      padding:10px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:rgba(255,255,255,.88);
      font-weight:1000;
      letter-spacing:.5px;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      text-align:center;
      font-size:12px;
      -webkit-tap-highlight-color: transparent;
    }
   .chip.active{
  background: linear-gradient(90deg, rgba(212,160,23,.28), rgba(242,201,76,.22));
  border-color: rgba(212,160,23,.6);
}


    /* âœ… GRID: ALWAYS 3 PER ROW ON PHONE TOO */
    .grid{
      display:grid;
      gap:12px;
      grid-template-columns: repeat(2, minmax(0, 1fr)); /* 3 per line always */
    }

    /* ========= CARDS (phone optimized) ========= */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(10,10,10,.92));
      border:1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,.50);
      position:relative;
    }

    .card-top{
      padding:10px 10px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .pill{
      padding:6px 9px;
      border-radius:999px;
      font-size:10px;
      font-weight:1000;
      letter-spacing:.6px;
      text-transform:uppercase;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color:rgba(255,255,255,.92);
      white-space:nowrap;
    }
    .pill.sealed{
  border-color: rgba(212,160,23,.65);
  background: rgba(212,160,23,.22);
  color:#1a1a1a;
}

.pill.unsealed{
  border-color: rgba(242,201,76,.65);
  background: rgba(242,201,76,.28);
  color:#1a1a1a;
}

    .pill.sold{ border-color: rgba(255,255,255,.20); background: rgba(255,255,255,.08); color:rgba(255,255,255,.72); }
    .stock{
      font-size:10px;
      font-weight:1000;
      color: rgba(255,255,255,.70);
      white-space:nowrap;
    }

    .media{ padding:10px; }
    .media img{
      width:100%;
      aspect-ratio: 1 / 1;         /* square = nicer for 3-per-row */
      object-fit: cover;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.25);
      box-shadow: 0 14px 34px rgba(0,0,0,.55);
    }

    .card-body{
      padding: 0 10px 12px;
    }
    .pname{
      margin:0;
      font-size: 12px;
      font-weight: 1000;
      line-height: 1.12;
      letter-spacing: .2px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 2.4em;
    }

    .meta{
      margin-top:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .price{
      font-weight:1000;
      font-size: 13px;
      letter-spacing:.2px;
    }
    .hint{
      font-size:10px;
      font-weight:900;
      color: rgba(255,255,255,.62);
      text-align:right;
      white-space:nowrap;
    }

    /* Phone-friendly controls */
    .controls{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .qty{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      padding:6px 8px;
      border-radius: 999px;
      user-select:none;
    }
    .qty button{
      width:34px; height:34px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
      font-weight:1000;
      font-size:18px;
      -webkit-tap-highlight-color: transparent;
    }
    .qty .num{
      width: 22px;
      text-align:center;
      font-weight:1000;
      font-size:12px;
    }

    .add{
      width:100%;
      padding:12px 10px;
      border-radius: 999px;
      border:0;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.7px;
      text-transform:uppercase;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color:#0b0b0b;
      box-shadow: 0 16px 40px rgba(212,160,23,.22);
      -webkit-tap-highlight-color: transparent;
    }
    .add:disabled{
      cursor:not-allowed;
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.55);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
    }

    /* On larger screens keep 3 per row but make cards roomier */
    @media (min-width: 820px){
      .grid{ gap:16px; }
      .card{ border-radius: 22px; box-shadow: var(--shadow2); }
      .media img{ aspect-ratio: 4 / 5; }
      .pname{ font-size: 14px; min-height: 2.5em; }
      .price{ font-size: 16px; }
    }

    /* ========= CART (bottom sheet) ========= */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.66);
      backdrop-filter: blur(7px);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index:80;
    }
    .overlay.show{ display:flex; }

    .modal{
      width: min(620px, 100%);
      background: linear-gradient(180deg, rgba(20,20,20,.98), rgba(10,10,10,.98));
      border:1px solid rgba(255,255,255,.12);
      border-radius: 22px 22px 0 0;
      box-shadow: var(--shadow2);
      overflow:hidden;
      max-height: 92vh;
      display:flex;
      flex-direction:column;
      transform: translateY(18px);
      transition: transform .2s ease;
    }
    .overlay.show .modal{ transform: translateY(0); }

    .modal-head{
      padding:12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .modal-head h3{
      margin:0;
      font-size:13px;
      letter-spacing:.8px;
      text-transform:uppercase;
      color: rgba(255,255,255,.90);
      font-weight:1000;
    }
    .close{
      width:42px; height:42px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      font-weight:1000;
      -webkit-tap-highlight-color: transparent;
    }
    .modal-body{
      padding:12px 16px 8px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .cart-list{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom:12px;
    }
    .cart-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .cart-item .left{
      min-width:0;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .cart-item .left .n{
      font-weight:1000;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size:13px;
    }
    .cart-item .left .sub{
      font-size:11px;
      color: rgba(255,255,255,.70);
      font-weight:900;
    }
    .cart-item .right{
      display:flex;
      align-items:center;
      gap:10px;
      flex-shrink:0;
    }
    .mini-qty{ display:flex; align-items:center; gap:6px; }
    .mini-qty button{
      width:36px; height:36px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
      font-weight:1000;
      font-size:16px;
      -webkit-tap-highlight-color: transparent;
    }
    .mini-qty span{ width:22px; text-align:center; font-weight:1000; }
    .remove{
      width:36px; height:36px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.85);
      cursor:pointer;
      font-weight:1000;
      -webkit-tap-highlight-color: transparent;
    }

    .totals{
      margin-top:8px;
      padding:12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-weight:1000;
      color: rgba(255,255,255,.85);
      font-size:13px;
    }
    .row strong{ color: rgba(255,255,255,.95); }
    .row.total{
      padding-top:8px;
      border-top:1px solid rgba(255,255,255,.08);
      font-size:15px;
    }

    .modal-actions{
      padding:12px 16px calc(10px + env(safe-area-inset-bottom));
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .wa{
      width:100%;
      padding:14px 16px;
      border-radius: 999px;
      border:0;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.8px;
      text-transform:uppercase;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color:#0b0b0b;
      box-shadow: 0 16px 40px rgba(255,59,10,.18);
      -webkit-tap-highlight-color: transparent;
    }
    .secondary{
      width:100%;
      padding:12px 16px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.7px;
      text-transform:uppercase;
      -webkit-tap-highlight-color: transparent;
    }
    .empty{
      padding:16px 12px;
      text-align:center;
      color: rgba(255,255,255,.7);
      font-weight:1000;
    }

    footer{
      padding:22px 0;
      border-top:1px solid rgba(255,255,255,.06);
      color: rgba(255,255,255,.7);
      margin-top: 10px;
    }
    footer .wrap{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .tiny{ font-size:12px; letter-spacing:.3px; font-weight:900; }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; scroll-behavior:auto !important; }
    }
  </style>
</head>

<body>
  <!-- âœ… Topbar (better on phone than floating button) -->
  <div class="topbar">
    <div class="topbar-inner wrap safe">
      <div class="brand-mini" onclick="document.getElementById('top').scrollIntoView({behavior:'smooth'})">
        <div class="brand-dot" aria-hidden="true"></div>
        <div style="min-width:0;">
          <div class="name">Diecast Society LB</div>
          <div class="sub">Sealed & Unsealed â€¢ Lebanon</div>
        </div>
      </div>

      <div class="cart-pill" id="openCart" title="Open Cart">
        <span class="cart-icon" aria-hidden="true"></span>
        <span class="label">Cart</span>
        <span class="badge" id="cartCount">0</span>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero" id="top">
    <div class="wrap safe">
      <div class="hero-card">
        <div class="hero-inner">
          <img class="logo" src="Logo.jpeg" alt="Diecast Society LB Logo" />
          <h1 class="title">Diecast Society LB</h1>
          <p class="tagline">Limited pieces â€¢ quick order via WhatsApp</p>
          <div class="cta-row">
            <button class="btn btn-primary" onclick="document.getElementById('shop').scrollIntoView({behavior:'smooth'})">Shop</button>
            <button class="btn btn-ghost" onclick="openCart()">View Cart</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- SHOP -->
  <section class="section" id="shop">
    <div class="wrap safe">
      <div class="section-header">
        <h2>Available Cars</h2>
        <div class="filters" id="filters"></div>
      </div>

      <!-- âœ… 3 per line on phone -->
      <div class="grid" id="grid"></div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="wrap safe">
      <div class="tiny">Â© <span id="year"></span> Diecast Society LB</div>
      <div class="tiny">Buy via WhatsApp â€¢ Limited Stock</div>
    </div>
  </footer>

  <!-- CART MODAL -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Cart">
    <div class="modal">
      <div class="modal-head">
        <h3>Your Cart</h3>
        <button class="close" id="closeCart" aria-label="Close">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="cart-list" id="cartList"></div>

        <div class="totals">
          <div class="row"><span>Subtotal</span><strong id="subTotal">$0</strong></div>
          <div class="row"><span>Delivery</span><strong id="delivery">$2</strong></div>
          <div class="row total"><span>Total</span><strong id="grandTotal">$0</strong></div>
          <div class="tiny" style="color:rgba(255,255,255,.62);">Delivery is added once per order.</div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="wa" id="buyWA">Buy on WhatsApp</button>
        <button class="secondary" id="continueShopping">Continue Shopping</button>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * CONFIG
     ***********************/
    const WHATSAPP_NUMBER = "96171979441"; // no +, no spaces
    const DELIVERY_FEE = 2;

    // âœ… Set condition: "Sealed" or "Unsealed"
    // âœ… stock=0 => SOLD OUT + button disabled
    const products = [

      { id:"Porsche 911 Carrera RS 2.7",         name:"Porsche 911 Carrera RS 2.7", price:15, stock:1, condition:"Sealed", image:"car1.heic" },
      { id:"BMW M3 Wagon",         name:"BMW M3 Wagon", price:10, stock:1, condition:"Sealed", image:"car2.heic" },
      
    ];

    /***********************
     * STATE
     ***********************/
    const cart = new Map(); // id -> qty
    let activeFilter = "All"; // All | Sealed | Unsealed
    const tempQty = {}; // per product

    /***********************
     * HELPERS
     ***********************/
    const $ = (sel) => document.querySelector(sel);
    const money = (n) => `$${Number(n).toFixed(0)}`;
    $("#year").textContent = new Date().getFullYear();

    function getProduct(id){ return products.find(p => p.id === id); }

    function cartItemCount(){
      let c = 0;
      for (const qty of cart.values()) c += qty;
      return c;
    }
    function cartSubtotal(){
      let sum = 0;
      for (const [id, qty] of cart.entries()){
        const p = getProduct(id);
        sum += p.price * qty;
      }
      return sum;
    }
    function clampCartToStock(){
      for (const [id, qty] of cart.entries()){
        const p = getProduct(id);
        const max = Math.max(0, p.stock);
        if (max === 0) cart.delete(id);
        else if (qty > max) cart.set(id, max);
      }
    }

    function readTemp(id){
      if (!(id in tempQty)) tempQty[id] = 1;
      return tempQty[id];
    }
    function writeTemp(id, val){
      tempQty[id] = val;
      const el = document.getElementById(`temp_${id}`);
      if (el) el.textContent = val;
    }

    /***********************
     * FILTERS (3 buttons)
     ***********************/
    function buildFilters(){
      const filtersEl = $("#filters");
      filtersEl.innerHTML = "";
      const filterList = ["All","Sealed","Crazy Deals"];


      filterList.forEach(f => {
        const chip = document.createElement("div");
        chip.className = "chip" + (f === activeFilter ? " active" : "");
        chip.textContent = f;
        chip.onclick = () => {
          activeFilter = f;
          buildFilters();
          renderGrid();
        };
        filtersEl.appendChild(chip);
      });
    }

    /***********************
     * GRID (3 per row always)
     ***********************/
    function renderGrid(){
      const grid = $("#grid");
      grid.innerHTML = "";

      const filtered = products.filter(p => activeFilter === "All" ? true : p.condition === activeFilter);

      filtered.forEach(p => {
        const isSoldOut = p.stock <= 0;
        const inCart = cart.get(p.id) || 0;
        const maxAddable = Math.max(0, p.stock - inCart);

        const label = isSoldOut ? "SOLD OUT" : p.condition.toUpperCase();
        const pillClass = isSoldOut
  ? "sold"
  : (p.condition === "Sealed" ? "sealed" : "unsealed");


        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="card-top">
            <span class="pill ${pillClass}">${label}</span>
            <span class="stock">${isSoldOut ? "No stock" : `${p.stock} in stock`}</span>
          </div>

          <div class="media">
            <img src="${p.image}" alt="${p.name}" onerror="this.style.opacity=.35; this.style.filter='grayscale(1)';" />
          </div>

          <div class="card-body">
            <h3 class="pname">${p.name}</h3>

            <div class="meta">
              <div class="price">${money(p.price)}</div>
              <div class="hint">${isSoldOut ? "" : (maxAddable === 0 ? "Max" : `Add ${maxAddable}`)}</div>
            </div>

            <div class="controls">
              <div class="qty" ${isSoldOut ? 'style="opacity:.55; pointer-events:none;"' : ""}>
                <button type="button" onclick="decTemp('${p.id}')" aria-label="Decrease">âˆ’</button>
                <span class="num" id="temp_${p.id}">${Math.max(1, Math.min(readTemp(p.id), Math.max(1, maxAddable)))}</span>
                <button type="button" onclick="incTemp('${p.id}')" aria-label="Increase">+</button>
              </div>

              <button type="button" class="add" id="add_${p.id}" ${isSoldOut ? "disabled" : ""} onclick="addToCart('${p.id}')">
                ${isSoldOut ? "Sold Out" : "Add"}
              </button>
            </div>
          </div>
        `;
        grid.appendChild(card);

        const addBtn = document.getElementById(`add_${p.id}`);
        if (!isSoldOut && maxAddable === 0){
          addBtn.disabled = true;
          addBtn.textContent = "Max";
        }
      });

      updateBadge();
    }

    function incTemp(id){
      const p = getProduct(id);
      const inCart = cart.get(id) || 0;
      const addable = Math.max(0, p.stock - inCart);
      const current = readTemp(id);
      const next = Math.min(current + 1, Math.max(1, addable));
      writeTemp(id, next);
    }
    function decTemp(id){
      const current = readTemp(id);
      writeTemp(id, Math.max(1, current - 1));
    }

    /***********************
     * CART
     ***********************/
    function addToCart(id){
      const p = getProduct(id);
      if (!p) return;

      const current = cart.get(id) || 0;
      const wanted = readTemp(id);
      const canAdd = Math.max(0, p.stock - current);
      const toAdd = Math.min(wanted, canAdd);

      if (toAdd <= 0){
        renderGrid(); renderCart();
        return;
      }

      cart.set(id, current + toAdd);
      clampCartToStock();
      renderGrid();
      renderCart();
      openCart();
    }

    function updateBadge(){
      $("#cartCount").textContent = cartItemCount();
    }

    function renderCart(){
      clampCartToStock();

      const list = $("#cartList");
      list.innerHTML = "";

      if (cart.size === 0){
        list.innerHTML = `<div class="empty">Your cart is empty.</div>`;
      } else {
        for (const [id, qty] of cart.entries()){
          const p = getProduct(id);
          const item = document.createElement("div");
          item.className = "cart-item";
          item.innerHTML = `
            <div class="left">
              <div class="n">${p.name}</div>
              <div class="sub">${p.condition.toUpperCase()} â€¢ ${money(p.price)} each â€¢ Stock: ${p.stock}</div>
            </div>
            <div class="right">
              <div class="mini-qty">
                <button type="button" onclick="cartDec('${id}')" aria-label="Decrease">âˆ’</button>
                <span>${qty}</span>
                <button type="button" onclick="cartInc('${id}')" aria-label="Increase">+</button>
              </div>
              <button type="button" class="remove" onclick="removeItem('${id}')" aria-label="Remove">ðŸ—‘</button>
            </div>
          `;
          list.appendChild(item);
        }
      }

      const sub = cartSubtotal();
      const delivery = cart.size ? DELIVERY_FEE : 0;
      const total = sub + delivery;

      $("#subTotal").textContent = money(sub);
      $("#delivery").textContent = money(delivery);
      $("#grandTotal").textContent = money(total);

      updateBadge();
    }

    function cartInc(id){
      const p = getProduct(id);
      const current = cart.get(id) || 0;
      if (current < p.stock) cart.set(id, current + 1);
      clampCartToStock();
      renderGrid();
      renderCart();
    }
    function cartDec(id){
      const current = cart.get(id) || 0;
      if (current <= 1) cart.delete(id);
      else cart.set(id, current - 1);
      renderGrid();
      renderCart();
    }
    function removeItem(id){
      cart.delete(id);
      renderGrid();
      renderCart();
    }

    /***********************
     * WHATSAPP MESSAGE
     ***********************/
    function buildWhatsAppMessage(){
      const lines = [];
      lines.push("Hi! I want to buy:");
      lines.push("");
      for (const [id, qty] of cart.entries()){
        const p = getProduct(id);
        lines.push(`- ${p.name} (Qty: ${qty})`);
      }
      const sub = cartSubtotal();
      const delivery = cart.size ? DELIVERY_FEE : 0;
      const total = sub + delivery;

      lines.push("");
      lines.push(`Delivery: ${money(delivery)}`);
      lines.push(`Total: ${money(total)}`);
      return lines.join("\n");
    }
    function goWhatsApp(){
      if (cart.size === 0) return;
      const msg = buildWhatsAppMessage();
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(url, "_blank");
    }

    /***********************
     * MODAL
     ***********************/
    const overlay = $("#overlay");

    function openCart(){
      renderCart();
      overlay.classList.add("show");
      document.body.style.overflow = "hidden";
    }
    function closeCart(){
      overlay.classList.remove("show");
      document.body.style.overflow = "";
    }

    // expose for inline handlers
    window.openCart = openCart;
    window.closeCart = closeCart;
    window.incTemp = incTemp;
    window.decTemp = decTemp;
    window.addToCart = addToCart;
    window.cartInc = cartInc;
    window.cartDec = cartDec;
    window.removeItem = removeItem;

    document.getElementById("openCart").addEventListener("click", openCart);
    document.getElementById("closeCart").addEventListener("click", closeCart);
    document.getElementById("continueShopping").addEventListener("click", () => {
      closeCart();
      document.getElementById("shop").scrollIntoView({behavior:"smooth"});
    });
    document.getElementById("buyWA").addEventListener("click", goWhatsApp);

    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeCart();
    });

    // Swipe down to close
    (function enableSwipeToClose(){
      const modal = document.querySelector(".modal");
      let startY = 0, currentY = 0, dragging = false;

      modal.addEventListener("touchstart", (e) => {
        const isHeader = e.target.closest(".modal-head");
        if (!isHeader) return;
        dragging = true;
        startY = e.touches[0].clientY;
        currentY = startY;
      }, {passive:true});

      modal.addEventListener("touchmove", (e) => {
        if (!dragging) return;
        currentY = e.touches[0].clientY;
        const dy = Math.max(0, currentY - startY);
        modal.style.transform = `translateY(${dy}px)`;
      }, {passive:true});

      modal.addEventListener("touchend", () => {
        if (!dragging) return;
        dragging = false;
        const dy = Math.max(0, currentY - startY);
        if (dy > 110) closeCart();
        modal.style.transform = "";
      });
    })();

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeCart();
    });

    /***********************
     * INIT
     ***********************/
    buildFilters();
    renderGrid();
    renderCart();
  </script>
</body>
</html>






